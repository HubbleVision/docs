---
id: text2sql
title: "Agent API"
description: "Convert natural language queries to SQL and execute"
sidebar_label: "Text2SQL"
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { ApiPlaygroundButton } from '@site/src/components/ApiPlaygroundModal';
import ResponseTabs from '@site/src/components/ResponseTabs';
import RequestParametersTable from '@site/src/components/RequestParametersTable';

# Text2SQL Conversion API

Convert natural language queries to SQL queries and execute them, returning query results. Supports both streaming and non-streaming response modes.

<div className="api-header">
  <div className="api-info">
    <span className="api-method">POST</span>
    <span className="api-path">/agent/api/v2/text2sql</span>
  </div>
  <ApiPlaygroundButton 
    initialApi="text2sql" 
    initialEndpoint="text2sql-conversion"
    className="api-try-button"
  >
    Try it ▶
  </ApiPlaygroundButton>
</div>

## Request Parameters

<RequestParametersTable apiId="text2sql" endpointId="text2sql-conversion" />

## AI SQL Generation

The system automatically analyzes your natural language query and generates corresponding SQL statements:

- **Data Filtering** - Filter data based on conditions
- **Aggregation** - Statistics, sum, average and other calculations
- **Time Range** - Date and time period filtering
- **Sorting & Grouping** - Data sorting and grouping operations
- **Multi-table Joins** - Cross-table data queries

## Response Format

### Standard Response (stream: false)

```json
{
  "data": {
    "sql": "SELECT ...",
    "rows": [
      {"token": "ABC", "volume": 12345},
      {"token": "XYZ", "volume": 67890}
    ]
  }
}
```

### Streaming Response (stream: true)

**SSE Streaming Events** - Each event is sent as a single line with Server-Sent Events format:

#### Recommended Usage with curl

```bash
curl -N -H "Content-Type: application/json" \
     -H "HUBBLE-API-KEY: <YOUR_KEY>" \
     https://api.hubble-rpc.xyz/agent/api/v2/text2sql \
     -d '{"query":"Show me the top 10 token trades by volume today","stream":true}'
```

#### Response Format

Each streaming event follows this structure:

```
data: {"id":"...","phase":"plan","status":"end","message":"plan phase completed","duration":285,"timestamp":"2025-08-21T05:09:29.825Z","plan":["[Query] Get the top 10 token trades by volume from the DEX table for today with time filter and LIMIT 10."]}

data: {"id":"...","phase":"sql_generation","status":"start","message":"sql_generation phase started","timestamp":"2025-08-21T05:09:29.826Z"}

data: {"id":"...","phase":"sql_generation","status":"end","message":"sql_generation phase completed","duration":2666,"timestamp":"2025-08-21T05:09:32.492Z","rowCount":10}

data: {"id":"...","phase":"data_display","status":"start","message":"data_display phase started","timestamp":"2025-08-21T05:09:32.492Z"}
```

### Event Types (Streaming)

| Event Name | Description | Commonly Used |
|------------|-------------|---------------|
| `token` | LLM real-time generated tokens (streaming output content) | ✅ Common |
| `result` | Final query result | ✅ Common |
| `complete` | Entire process completed | ✅ Common |
| `error` | Error occurred | ✅ Common |

**Recommendation for developers:** Focus mainly on `token`, `result`, `complete`, and `error` events.

## Code Examples

<Tabs>
  <TabItem value="curl" label="cURL">

```bash
curl -X POST "https://api.hubble-rpc.xyz/agent/api/v2/text2sql" \
  -H "Content-Type: application/json" \
  -H "HUBBLE-API-KEY: your-api-key" \
  -d '{
    "query": "Show me the top 10 token trades by volume today",
    "stream": false
  }'
```

  </TabItem>
  <TabItem value="javascript" label="JavaScript">

```javascript
// Fetch + JSON (Non-streaming)
fetch("/agent/api/v2/text2sql", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "HUBBLE-API-KEY": "your-api-key"
  },
  body: JSON.stringify({
    query: "Show me the top 10 token trades by volume today",
    stream: false
  })
}).then(res => res.json()).then(console.log);

// Fetch + SSE (Streaming)
fetch("/agent/api/v2/text2sql", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "HUBBLE-API-KEY": "your-api-key"
  },
  body: JSON.stringify({
    query: "Show me the top 10 token trades by volume today",
    stream: true
  })
}).then(async response => {
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    console.log(decoder.decode(value));
  }
});
```

  </TabItem>
</Tabs>

## Responses

<ResponseTabs apiId="text2sql" endpointId="text2sql-conversion" />